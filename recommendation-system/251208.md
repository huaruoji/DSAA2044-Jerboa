# ğŸ“Š å½“å‰æ¨èç³»ç»Ÿæ¶æ„å®Œæ•´è§£æ

## ğŸ”„ æ•´ä¸ªæ¨èé€»è¾‘æµç¨‹

### 1. **è®­ç»ƒé˜¶æ®µï¼ˆç¦»çº¿ï¼Œä½¿ç”¨Redditæ•°æ®é›†ï¼‰**

```
Reddit CSVæ•°æ® 
    â†“
æ¸…æ´—æ–‡æœ¬ (clean_text)
    â†“
TF-IDF Vectorizerè®­ç»ƒ
    â†“
ä¿å­˜æ¨¡å‹å·¥ä»¶:
  - tfidf_vectorizer.pkl  (è¯æ±‡è¡¨ + IDFæƒé‡)
  - tfidf_matrix.pkl      (è®­ç»ƒé›†çš„TF-IDFçŸ©é˜µï¼Œå·²åºŸå¼ƒ)
  - model_metadata.pkl    (å…ƒæ•°æ®)
```

**Redditæ•°æ®é›†çš„ä½œç”¨**ï¼š
- âœ… **è®­ç»ƒTF-IDF Vectorizer**ï¼šå­¦ä¹ è¯æ±‡è¡¨å’ŒIDFï¼ˆé€†æ–‡æ¡£é¢‘ç‡ï¼‰æƒé‡
- âŒ **ä¸å†ç”¨äºæ¨è**ï¼šæˆ‘ä»¬ä¸å†è¿”å›Redditå¸–å­

---

### 2. **æ¨èé˜¶æ®µï¼ˆåœ¨çº¿ï¼Œä½¿ç”¨LemmyçœŸå®æ•°æ®ï¼‰**

```
ç”¨æˆ·æµè§ˆLemmyå¸–å­
    â†“
Localå­˜å‚¨å†å² (SharedPreferences)
  - æœ€è¿‘50æ¡
  - æ ‡é¢˜ + æ­£æ–‡
    â†“
ç”¨æˆ·åˆ‡æ¢åˆ° For You Tab
    â†“
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
Androidç«¯: ForYouViewModel.loadRecommendations()
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
    â†“
1. ä»Lemmy APIè·å–å€™é€‰å¸–å­
   API.getInstance().getPosts(
     sort = Active,
     limit = 50
   )
    â†“
2. æå–å€™é€‰ä¿¡æ¯
   candidates = posts.map {
     id: post.id,
     title: post.name,
     body: post.body ?: ""
   }
    â†“
3. è¯»å–ç”¨æˆ·å†å²
   history = UserHistoryRepository.getRecentHistory()
    â†“
4. å‘é€åˆ°æ¨èåç«¯
   POST /api/score
   {
     "history_contents": [
       "Trump news...",
       "AI technology...",
       ...
     ],
     "candidates": [
       {id: "123", title: "...", body: "..."},
       ...
     ]
   }
    â†“
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
åç«¯: Flask /api/score
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
    â†“
5. æ„å»ºç”¨æˆ·ç”»åƒ
   combined_history = "Trump news AI technology ..."
   history_vector = vectorizer.transform([combined_history])
    â†“
6. ä¸ºæ¯ä¸ªå€™é€‰æ‰“åˆ†
   for candidate in candidates:
     combined_text = f"{title} {title} {body}"
     candidate_vector = vectorizer.transform([combined_text])
     similarity = cosine_similarity(history_vector, candidate_vector)
    â†“
7. è¿”å›æ‰“åˆ†ç»“æœ
   {
     "scored_candidates": [
       {"id": "123", "similarity_score": 0.85},
       {"id": "456", "similarity_score": 0.72},
       ...
     ]
   }
    â†“
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
Androidç«¯: æ¥æ”¶å¹¶æ’åº
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
    â†“
8. æŒ‰åˆ†æ•°é‡æ–°æ’åºLemmyå¸–å­
   sortedPosts = originalPosts.sortedByDescending { 
     scoreMap[it.id] 
   }
    â†“
9. æ˜¾ç¤ºåœ¨For Youé¡µé¢
   PostListings(posts = sortedPosts)
```

---

## ğŸ“¦ Redditæ•°æ®é›†çš„ç°çŠ¶å’Œä½œç”¨

### âœ… **ä»ç„¶æœ‰ç”¨çš„éƒ¨åˆ†**

1. **è®­ç»ƒVectorizer**
   - å­¦ä¹ äº†10,000ä¸ªæœ€é‡è¦çš„è¯æ±‡
   - è®¡ç®—äº†æ¯ä¸ªè¯çš„IDFæƒé‡ï¼ˆç¨€æœ‰è¯æƒé‡æ›´é«˜ï¼‰
   - è¿™ä¸ªè¯æ±‡è¡¨å’Œæƒé‡å¯ä»¥åº”ç”¨åˆ°**ä»»ä½•**è‹±æ–‡æ–‡æœ¬ï¼ˆåŒ…æ‹¬Lemmyå¸–å­ï¼‰

### âŒ **å·²åºŸå¼ƒçš„éƒ¨åˆ†**

1. **`tfidf_matrix.pkl`**
   - è¿™æ˜¯Redditè®­ç»ƒé›†æ‰€æœ‰å¸–å­çš„å‘é‡è¡¨ç¤º
   - åœ¨æ–°æ¶æ„ä¸­**å®Œå…¨ä¸ç”¨**
   - å¯ä»¥åˆ é™¤ä»¥èŠ‚çœç©ºé—´

2. **`processed_posts.pkl`**
   - Redditå¸–å­çš„DataFrame
   - `recommend_from_history()` æ–¹æ³•ä¼šç”¨åˆ°ï¼Œä½†è¿™ä¸ªæ–¹æ³•å·²æ ‡è®°ä¸º `[LEGACY]`
   - æ–°çš„ `score_candidates()` æ–¹æ³•ä¸éœ€è¦å®ƒ

---

## ğŸ¯ æ”¹è¿›å»ºè®®

### 1. **ç«‹å³å¯åšçš„ä¼˜åŒ–**

#### A. æ¸…ç†æ— ç”¨æ–‡ä»¶
```python
# åˆ é™¤è¿™äº›æ–‡ä»¶ï¼ˆæ–°æ¶æ„ä¸éœ€è¦ï¼‰
recommendation-system/models/tfidf_matrix.pkl       # ~100MB
recommendation-system/models/processed_posts.pkl    # ~50MB
```

#### B. ä¼˜åŒ–è®­ç»ƒè„šæœ¬
```python
# train_recommendation_model.py
# åªéœ€è¦ä¿å­˜ vectorizerï¼Œä¸éœ€è¦ä¿å­˜æ•´ä¸ªçŸ©é˜µ

# ç§»é™¤è¿™äº›è¡Œ:
# with open(f'{models_dir}/tfidf_matrix.pkl', 'wb') as f:
#     pickle.dump(tfidf_matrix, f)
# with open(f'{models_dir}/processed_posts.pkl', 'wb') as f:
#     pickle.dump(df, f)
```

#### C. æ·»åŠ ç¼“å­˜æœºåˆ¶
```python
# ForYouViewModel.kt
private var cachedRecommendations: List<PostView>? = null
private var cacheTimestamp: Long = 0
private val CACHE_TTL = 5 * 60 * 1000 // 5åˆ†é’Ÿ

fun loadRecommendations() {
    val now = System.currentTimeMillis()
    if (cachedRecommendations != null && now - cacheTimestamp < CACHE_TTL) {
        _posts.value = cachedRecommendations!!
        return
    }
    // ... å¦åˆ™é‡æ–°è·å–
}
```

---

### 2. **ä¸­æœŸæ”¹è¿›ï¼ˆ1-2å‘¨ï¼‰**

#### A. æ··åˆæ¨èç­–ç•¥
```python
# ç»“åˆå¤šç§ä¿¡å·
final_score = (
    0.6 * content_similarity +     # å†…å®¹ç›¸ä¼¼åº¦
    0.2 * recency_score +          # æ–°é²œåº¦ï¼ˆæœ€è¿‘å‘å¸ƒçš„å¸–å­ï¼‰
    0.1 * popularity_score +       # çƒ­åº¦ï¼ˆupvotesï¼‰
    0.1 * diversity_penalty        # å¤šæ ·æ€§ï¼ˆé¿å…æ¨èåŒä¸€å­ç‰ˆå—ï¼‰
)
```

#### B. å¢é‡æ›´æ–°å†å²
```kotlin
// ä¸è¦æ¯æ¬¡éƒ½ä¼ æ•´ä¸ªå†å²ï¼Œåªä¼ æ–°å¢çš„
data class ScoreRequest(
    val new_views: List<String>,        // æ–°æµè§ˆçš„å¸–å­
    val last_recommendation_id: String  // ä¸Šæ¬¡æ¨èçš„ID
)
```

#### C. A/Bæµ‹è¯•æ¡†æ¶
```python
# åç«¯éšæœºé€‰æ‹©ç®—æ³•
if user_id % 2 == 0:
    use_tfidf()
else:
    use_collaborative_filtering()
```

---

### 3. **é•¿æœŸæ”¹è¿›ï¼ˆ1-2æœˆï¼‰**

#### A. å‡çº§åˆ°BERT
```python
from sentence_transformers import SentenceTransformer

class BERTRecommender(BaseRecommender):
    def __init__(self):
        self.model = SentenceTransformer('all-MiniLM-L6-v2')
    
    def score_candidates(self, history_contents, candidates):
        # ç”Ÿæˆè¯­ä¹‰å‘é‡
        history_embedding = self.model.encode(
            ' '.join(history_contents)
        )
        
        candidate_embeddings = self.model.encode([
            f"{c['title']} {c['body']}" for c in candidates
        ])
        
        # è®¡ç®—ä½™å¼¦ç›¸ä¼¼åº¦
        similarities = cosine_similarity(
            [history_embedding], 
            candidate_embeddings
        )[0]
        
        return [
            {'id': c['id'], 'similarity_score': float(s)}
            for c, s in zip(candidates, similarities)
        ]
```

**BERTçš„ä¼˜åŠ¿**ï¼š
- ç†è§£è¯­ä¹‰ï¼ˆ"dog" å’Œ "puppy" å¾ˆç›¸ä¼¼ï¼‰
- TF-IDFåªçœ‹è¯é¢‘ï¼ˆ"dog" â‰  "puppy"ï¼‰

#### B. ååŒè¿‡æ»¤
```python
# æ”¶é›†ç”¨æˆ·äº¤äº’æ•°æ®
user_interactions = {
    'user_123': ['post_1', 'post_5', 'post_8'],
    'user_456': ['post_1', 'post_3', 'post_9'],
    ...
}

# æ¨èé€»è¾‘
# "æµè§ˆè¿‡post_1çš„ç”¨æˆ·ä¹Ÿæµè§ˆäº†post_5"
```

#### C. åœ¨çº¿å­¦ä¹ 
```python
# æ ¹æ®ç”¨æˆ·çš„ç‚¹å‡»/ä¸ç‚¹å‡»å®æ—¶è°ƒæ•´æ¨è
if user_skipped_recommendation:
    reduce_weight_of_similar_posts()
```

---

## ğŸ” å½“å‰æ¶æ„çš„ä¼˜ç¼ºç‚¹

### âœ… **ä¼˜ç‚¹**

1. **çœŸå®å†…å®¹**ï¼šæ¨èçš„éƒ½æ˜¯LemmyçœŸå®å¸–å­ï¼Œç”¨æˆ·å¯ä»¥æ­£å¸¸äº¤äº’
2. **çµæ´»æ€§**ï¼šå¯ä»¥è½»æ¾åˆ‡æ¢ç®—æ³•ï¼ˆTF-IDF â†’ BERT â†’ ååŒè¿‡æ»¤ï¼‰
3. **éšç§å‹å¥½**ï¼šå†å²æ•°æ®å­˜æœ¬åœ°ï¼Œåªå‘é€æ–‡æœ¬å†…å®¹åˆ°åç«¯
4. **å®æ—¶å€™é€‰**ï¼šæ€»æ˜¯æ¨èæœ€æ–°çš„æ´»è·ƒå¸–å­

### âš ï¸ **ç¼ºç‚¹**

1. **å†·å¯åŠ¨é—®é¢˜**ï¼šæ–°ç”¨æˆ·æ²¡æœ‰å†å²ï¼Œåªèƒ½æ¨èé€šç”¨çƒ­é—¨å†…å®¹
2. **è®¡ç®—å¼€é”€**ï¼šæ¯æ¬¡éƒ½è¦å‘é‡åŒ–50ä¸ªå€™é€‰å¸–å­
3. **å€™é€‰æ± å°**ï¼šåªä»50ä¸ªæ´»è·ƒå¸–å­ä¸­é€‰æ‹©ï¼Œå¯èƒ½ä¸å¤Ÿä¸ªæ€§åŒ–
4. **æ— åé¦ˆå¾ªç¯**ï¼šä¸çŸ¥é“æ¨èæ•ˆæœå¥½ä¸å¥½ï¼ˆç‚¹å‡»ç‡ã€åœç•™æ—¶é—´ï¼‰

---

## ğŸš€ æ¨èçš„ä¸‹ä¸€æ­¥

### **ç«‹å³åš**ï¼š
1. âœ… åˆ é™¤ `tfidf_matrix.pkl` å’Œ `processed_posts.pkl`
2. âœ… æ·»åŠ æ¨èç»“æœç¼“å­˜ï¼ˆ5åˆ†é’ŸTTLï¼‰
3. âœ… æ·»åŠ æ—¥å¿—è¿½è¸ªæ¨èæ•ˆæœ

### **æœ¬å‘¨åš**ï¼š
1. å®ç°æ··åˆè¯„åˆ†ï¼ˆå†…å®¹ + æ–°é²œåº¦ + çƒ­åº¦ï¼‰
2. å¢åŠ å€™é€‰æ± åˆ°100ä¸ªå¸–å­
3. æ·»åŠ å¤šæ ·æ€§æƒ©ç½šï¼ˆé¿å…åŒä¸€å­ç‰ˆå—æ‰å †ï¼‰

### **ä¸‹æœˆåš**ï¼š
1. è®­ç»ƒBERTæ¨¡å‹æ›¿æ¢TF-IDF
2. æ”¶é›†ç”¨æˆ·åé¦ˆæ•°æ®ï¼ˆç‚¹å‡»ç‡ã€åœç•™æ—¶é—´ï¼‰
3. å®ç°ä¸ªæ€§åŒ–å†·å¯åŠ¨ï¼ˆæ ¹æ®ç”¨æˆ·è®¢é˜…çš„ç¤¾åŒºæ¨èï¼‰

---

## ğŸ’¡ æ€»ç»“

**Redditæ•°æ®é›†ç°åœ¨åªç”¨æ¥è®­ç»ƒVectorizerçš„è¯æ±‡è¡¨å’ŒIDFæƒé‡**ï¼Œè¿™ä¸ªè®­ç»ƒå¥½çš„Vectorizerå¯ä»¥å¯¹ä»»ä½•è‹±æ–‡æ–‡æœ¬ï¼ˆåŒ…æ‹¬Lemmyå¸–å­ï¼‰è¿›è¡Œå‘é‡åŒ–ã€‚

**æ¨èæµç¨‹**ï¼š
```
ç”¨æˆ·å†å² â†’ å‘é‡åŒ– â†’ è®¡ç®—ç›¸ä¼¼åº¦ â†’ å¯¹Lemmyå€™é€‰å¸–å­æ‰“åˆ† â†’ æ’åºå±•ç¤º
```

è¿™æ˜¯ä¸€ä¸ª**å†…å®¹é©±åŠ¨**çš„æ¨èç³»ç»Ÿï¼Œä¸ä¾èµ–è®­ç»ƒé›†ä¸­çš„å…·ä½“å¸–å­ï¼Œåªä¾èµ–å­¦åˆ°çš„è¯­è¨€æ¨¡å‹ï¼ ğŸ‰